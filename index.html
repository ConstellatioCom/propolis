<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Graphe de mots-clés PROPOLIS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .chart-container {
            background-color: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.3s ease-in-out;
        }
        .tooltip {
            position: absolute;
            text-align: center;
            padding: 0.5rem;
            font-size: 0.875rem;
            background: #1f2937;
            color: white;
            border-radius: 0.5rem;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            max-width: 300px;
        }
        .node text {
            pointer-events: none;
            font-size: 10px;
            fill: #374151;
            font-weight: 500;
        }
        .link {
            stroke: #9ca3af;
            stroke-opacity: 0.8;
            stroke-width: 2px;
        }
        /* Style spécifique pour le noeud central */
        .central-node circle {
            stroke: #A0522D; /* Marron */
            stroke-width: 3px !important;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-800">Graphe de Mots-clés PROPOLIS (Star Graph)</h1>
            <p class="text-gray-600 mt-2 text-lg">Visualisation pour la stratégie Google Ads de marque.</p>
        </header>

        <div class="chart-container">
            <h3 class="text-xl font-bold text-gray-700 mb-4 text-center">Segmentation des prédicats autour du mot-clé central : PROPOLIS</h3>
            <p class="text-center text-sm text-gray-500 mb-4">Passez la souris sur les nœuds pour voir la catégorie.</p>
            <div id="chart-container" class="relative w-full h-[600px] border border-gray-200 rounded-lg"><svg id="star-graph" class="w-full h-full"></svg></div>
        </div>
    </div>

    <div id="tooltip" class="tooltip"></div>

    <script>
        // --- Données pour le graphe en étoile PROPOLIS ---
        const nodesData = [
            // Nœud Central
            { id: 'PROPOLIS', category: 'Centre', type: 'central' },
            // 1. Marque (Bleu)
            { id: 'propolis ingénierie', category: 'Marque', type: 'keyword' },
            { id: 'propolis engineering', category: 'Marque', type: 'keyword' },
            { id: 'cabinet propolis', category: 'Marque', type: 'keyword' },
            { id: 'propolis nanterre', category: 'Marque', type: 'keyword' },
            // 2. Expertise Spécifique (Vert)
            { id: 'propolis sûreté', category: 'Expertise Spécifique', type: 'keyword' },
            { id: 'propolis sécurité', category: 'Expertise Spécifique', type: 'keyword' },
            { id: 'propolis ingénierie sûreté', category: 'Expertise Spécifique', type: 'keyword' },
            { id: 'propolis audit sécurité', category: 'Expertise Spécifique', type: 'keyword' },
            // 3. Transactionnel (Orange)
            { id: 'propolis contact', category: 'Transactionnel', type: 'keyword' },
            { id: 'propolis téléphone', category: 'Transactionnel', type: 'keyword' },
            { id: 'propolis adresse', category: 'Transactionnel', type: 'keyword' },
            { id: 'propolis avis', category: 'Transactionnel', type: 'keyword' },
            { id: 'propolis recrutement', category: 'Transactionnel', type: 'keyword' },
        ];

        // Tous les mots-clés sont liés au nœud central "PROPOLIS"
        const linksData = nodesData.filter(d => d.type === 'keyword').map(d => ({
            source: 'PROPOLIS',
            target: d.id,
        }));

        // --- Couleurs pour les catégories (comme le Médicis, mais adapté) ---
        const colorScale = d3.scaleOrdinal()
            .domain(['Centre', 'Marque', 'Expertise Spécifique', 'Transactionnel'])
            .range(['#A0522D', '#4285F4', '#34A853', '#FBBC04']); // Marron, Bleu, Vert, Orange

        // --- Tooltip ---
        const tooltip = d3.select("#tooltip");

        // --- Fonction de rendu du graphe ---
        function renderStarGraph() {
            const svg = d3.select("#star-graph");
            const container = d3.select("#chart-container");
            const width = parseInt(container.style("width"));
            const height = parseInt(container.style("height"));
            svg.selectAll("*").remove();

            // Simulation de force D3
            const simulation = d3.forceSimulation(nodesData)
                .force("link", d3.forceLink(linksData).id(d => d.id).distance(120).strength(0.6)) // Distance plus grande pour le star
                .force("charge", d3.forceManyBody().strength(-150)) // Répulsion
                .force("center", d3.forceCenter(width / 2, height / 2).strength(1))
                .force("collide", d3.forceCollide().radius(d => (d.type === 'central' ? 30 : 18))); // Évite le chevauchement

            // Dessin des liens
            const link = svg.append("g").selectAll("line")
                .data(linksData)
                .join("line")
                .attr("class", "link");

            // Dessin des nœuds (groupes pour cercle + texte)
            const node = svg.append("g").selectAll("g")
                .data(nodesData)
                .join("g")
                .attr("class", d => `node ${d.type === 'central' ? 'central-node' : ''}`)
                .call(drag(simulation)); // Ajout de la fonction de drag

            // Cercles des nœuds
            node.append("circle")
                .attr("r", d => d.type === 'central' ? 25 : 15)
                .attr("fill", d => colorScale(d.category))
                .attr("stroke", "#fff")
                .attr("stroke-width", 2);

            // Texte des nœuds
            node.append("text")
                .text(d => d.id)
                .attr("x", d => d.type === 'central' ? 30 : 18)
                .attr("y", 5)
                .attr("fill", "#374151")
                .style("font-size", d => d.type === 'central' ? '12px' : '10px');

            // Interactivité (Tooltip et agrandissement)
            node.on("mouseover", (event, d) => {
                const radius = d.type === 'central' ? 30 : 20;
                d3.select(event.currentTarget).select("circle").transition().duration(150).attr("r", radius);
                tooltip.style("opacity", 1).html(`
                    <strong>${d.id}</strong><br>
                    <span style="color:${colorScale(d.category)};">
                        Catégorie : ${d.category}
                    </span>
                `);
            })
            .on("mousemove", (event) => {
                tooltip.style("left", (event.pageX + 15) + "px").style("top", (event.pageY - 28) + "px");
            })
            .on("mouseout", (event, d) => {
                const radius = d.type === 'central' ? 25 : 15;
                d3.select(event.currentTarget).select("circle").transition().duration(150).attr("r", radius);
                tooltip.style("opacity", 0);
            });

            // Mise à jour de la position à chaque "tick" de la simulation
            simulation.on("tick", () => {
                link
                    .attr("x1", d => d.source.x)
                    .attr("y1", d => d.source.y)
                    .attr("x2", d => d.target.x)
                    .attr("y2", d => d.target.y);

                node.attr("transform", d => `translate(${d.x},${d.y})`);
            });

            // Fonction de drag pour fixer les nœuds (dérivée de votre exemple)
            function drag(simulation) {
                function dragstarted(event, d) {
                    if (!event.active) simulation.alphaTarget(0.3).restart();
                    d.fx = d.x;
                    d.fy = d.y;
                }
                function dragged(event, d) {
                    d.fx = event.x;
                    d.fy = event.y;
                }
                function dragended(event, d) {
                    if (!event.active) simulation.alphaTarget(0);
                }
                return d3.drag()
                    .on("start", dragstarted)
                    .on("drag", dragged)
                    .on("end", dragended);
            }
        }

        // --- Rendu initial et redimensionnement ---
        window.addEventListener('load', renderStarGraph);
        window.addEventListener('resize', renderStarGraph);

    </script>
</body>
</html>
